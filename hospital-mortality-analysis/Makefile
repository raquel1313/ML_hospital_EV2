.PHONY: help setup start stop restart logs clean test kedro-run kedro-viz

help:
	@echo "ğŸ¥ Hospital Mortality Analysis - Comandos disponibles"
	@echo ""
	@echo "  make setup          - Configura el entorno inicial"
	@echo "  make start          - Inicia todos los servicios"
	@echo "  make stop           - Detiene todos los servicios"
	@echo "  make restart        - Reinicia todos los servicios"
	@echo "  make logs           - Muestra logs en tiempo real"
	@echo "  make logs-airflow   - Logs del scheduler de Airflow"
	@echo "  make clean          - Limpia contenedores y volÃºmenes"
	@echo "  make test           - Ejecuta tests del proyecto"
	@echo "  make kedro-run      - Ejecuta pipeline de Kedro localmente"
	@echo "  make kedro-viz      - Abre visualizaciÃ³n de Kedro"
	@echo "  make airflow-ui     - Abre interfaz de Airflow"
	@echo ""

setup:
	@echo "ğŸš€ Configurando entorno..."
	bash setup_airflow.sh

start:
	@echo "â–¶ï¸  Iniciando servicios..."
	docker-compose up -d
	@echo "âœ… Servicios iniciados!"
	@echo "ğŸŒ Airflow UI: http://localhost:8080"
	@echo "ğŸ‘¤ Usuario: airflow | ContraseÃ±a: airflow123"

stop:
	@echo "â¹ï¸  Deteniendo servicios..."
	docker-compose down

restart:
	@echo "ğŸ”„ Reiniciando servicios..."
	docker-compose restart

logs:
	@echo "ğŸ“‹ Mostrando logs..."
	docker-compose logs -f

logs-airflow:
	@echo "ğŸ“‹ Logs del scheduler de Airflow..."
	docker-compose logs -f airflow-scheduler

clean:
	@echo "ğŸ§¹ Limpiando contenedores y volÃºmenes..."
	docker-compose down -v
	rm -rf logs/* plugins/__pycache__

test:
	@echo "ğŸ§ª Ejecutando tests..."
	pytest

kedro-run:
	@echo "ğŸƒ Ejecutando pipeline de Kedro..."
	kedro run --pipeline=data_preparation

kedro-viz:
	@echo "ğŸ“Š Abriendo Kedro Viz..."
	kedro viz --host=0.0.0.0 --port=4141

airflow-ui:
	@echo "ğŸŒ Abriendo Airflow UI..."
	open http://localhost:8080 || xdg-open http://localhost:8080 || start http://localhost:8080

build:
	@echo "ğŸ—ï¸  Construyendo imagen Docker..."
	docker-compose build

status:
	@echo "ğŸ“Š Estado de los servicios:"
	docker-compose ps